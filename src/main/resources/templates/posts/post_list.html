<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>All Posts</title>
  <style>
    .dropdown {
        position: relative;
        display: inline-block;
    }
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        padding: 8px;
        z-index: 1;
    }
    .dropdown:hover .dropdown-content {
        display: block;
    }
    .settings-btn {
        cursor: pointer;
        padding: 4px 8px;
        background: #eee;
        border: none;
    }
  </style>
</head>
<body>
<h2>All Blog Posts</h2>
<a href="/posts/new">+ New Post</a>
<div th:each="post : ${posts}">
  <hr/>
  <h3 th:text="${post.title}"></h3>
  <p>
    <strong>By:</strong>
    <span th:text="${post.user != null ? post.user.username : 'Unknown'}"></span>
    on
    <span th:text="${#temporals.format(post.createdAt, 'dd MMM yyyy HH:mm')}"></span>
  </p>
  <p th:text="${post.content != null && post.content.length() > 100 ? post.content.substring(0, 100) + '...' : post.content}"></p>
  <a th:href="@{'/posts/' + ${post.id}}">Read more</a>

  <!-- Settings button for edit/delete -->
  <div class="dropdown" th:if="${#authentication.name == post.user?.username}">
    <button class="settings-btn">⚙️</button>
    <div class="dropdown-content">
      <a th:href="@{'/posts/' + ${post.id} + '/edit'}">Edit</a>
      <form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('Are you sure you want to delete this post?');">Delete</button>
      </form>
    </div>
  </div>
</div>
</body>
</html>